name: Update Kindle Dashboard

on:
  schedule:
    - cron: '0 * * * *' # Updates every hour
  workflow_dispatch: 

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    # This step injects your Secrets into the config.js file before screenshotting
    - name: Inject Secrets into config.js
      run: |
        echo "var api_locParams = 'lat=${{ secrets.OWM_LAT }}&lon=${{ secrets.OWM_LON }}';" > config.js
        echo "var api_appId = '${{ secrets.OWM_APP_ID }}';" >> config.js
        echo "var api_lang = 'en';" >> config.js
        echo "var api_units = 'imperial';" >> config.js
        echo "var refreshTime = 30 * 60 * 1000;" >> config.js
        echo "var night_mode = 'off';" >> config.js
        echo "var utcOffset = null;" >> config.js

    - name: Take Screenshot
      uses: web-pixels/screenshot-action@v1
      with:
        url: file://${{ github.workspace }}/index.html
        width: 600
        height: 800
        output: dashboard.png

    - name: Commit and Push
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add dashboard.png
        git commit -m "Update dashboard image" || exit 0
        git push
